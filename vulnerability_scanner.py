import os
from vulnerabilites_regex import SENSITIVE_PATTERNS

def search_vulnerabilities(decompiled_path):
    """Scans for vulnerabilities in the decompiled APK."""
    print("[+] Searching for vulnerabilities...")
    for root, _, files in os.walk(decompiled_path):
        for file in files:
            if file.endswith(".smali") or file.endswith("AndroidManifest.xml"):
                file_path = os.path.join(root, file)
                with open(file_path, "r", errors="ignore") as f:
                    content = f.readlines()
                
                for i, line in enumerate(content):
                    for issue, pattern in SENSITIVE_PATTERNS.items():
                        if pattern.search(line):
                            print(f"[!] {issue} detected in {file_path} (line {i+1})")
